<!DOCTYPE html>
<html>
<head>
  <title>Route Details</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>

<div class="nav">Route Details</div>
<div id="map"></div>
<div class="list" id="stops"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const id = new URLSearchParams(window.location.search).get("id");

let map = L.map("map").setView([17.385, 78.4867], 12);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

fetch(`https://orrbus.friendsofrtc.com/api/route/${id}/stops`)
  .then(r => r.json())
  .then(stops => {
    const el = document.getElementById("stops");

    let latlngs = [];

    stops.forEach(s => {
      el.innerHTML += `<div>${s.stop_name}</div>`;
      let p = [parseFloat(s.stop_lat), parseFloat(s.stop_lon)];
      latlngs.push(p);
      L.marker(p).addTo(map).bindPopup(s.stop_name);
    });

    if (latlngs.length > 1) L.polyline(latlngs, { color: "blue" }).addTo(map);

    map.fitBounds(latlngs);
  });
</script>

</body>
</html>
